# spikelength（穗长）性状深度分析报告

## 1. 概述

本报告聚焦于小麦穗长（spikelength）性状的基因组预测实验，系统对比了自研CNN深度学习模型与多种传统机器学习模型（RandomForest、XGBoost、LightGBM、Lasso）在不同SNP特征数量下的表现，并结合CNN网络结构进行机制分析。

## 2. 性能指标总览

| 模型           | 特征数 | R² (决定系数) | RMSE  | Pearson相关系数 |
|----------------|--------|--------------|-------|----------------|
| **CNN**        | 100    | 0.0655       | 0.9301| 0.3403         |
|                | 1000   | 0.1008       | 0.9124| 0.4210         |
|                | 3000   | 0.1790       | 0.8719| 0.4915         |
|                | 5000   | 0.2418       | 0.8378| 0.5441         |
|                | 7000   | 0.2724       | 0.8207| 0.5406         |
| **RandomForest**| 100   | 0.0854       | 0.9202| 0.3299         |
|                | 1000   | 0.1377       | 0.8935| 0.3887         |
|                | 3000   | 0.1466       | 0.8889| 0.3974         |
|                | 5000   | 0.1374       | 0.8937| 0.3879         |
|                | 7000   | 0.1523       | 0.8859| 0.4043         |
| **XGBoost**    | 100    | 0.0774       | 0.9242| 0.3042         |
|                | 1000   | 0.1917       | 0.8650| 0.4593         |
|                | 3000   | 0.1803       | 0.8712| 0.4538         |
|                | 5000   | 0.1697       | 0.8768| 0.4455         |
|                | 7000   | 0.1947       | 0.8635| 0.4689         |
| **LightGBM**   | 100    | -0.0519      | 0.9868| 0.2432         |
|                | 1000   | 0.1332       | 0.8958| 0.3893         |
|                | 3000   | 0.1770       | 0.8729| 0.4515         |
|                | 5000   | 0.1687       | 0.8773| 0.4508         |
|                | 7000   | 0.1716       | 0.8757| 0.4494         |
| **Lasso**      | 100    | 0.0219       | 0.9516| 0.2845         |
|                | 1000   | 0.1541       | 0.8850| 0.4415         |
|                | 3000   | 0.1081       | 0.9087| 0.3466         |
|                | 5000   | 0.1037       | 0.9109| 0.3413         |
|                | 7000   | 0.1513       | 0.8864| 0.4843         |

*注：所有数据均为最新实验结果。*

## 3. 深度分析

### 3.1 最佳模型表现

- **CNN_1000** 在1000个SNP时取得R²（0.1008）和Pearson相关系数（0.4210），在高特征数下性能持续提升。
- **RandomForest_7000** 在7000个SNP时R²达到0.1523，表现稳定。
- **XGBoost、LightGBM、Lasso** 在高特征数（3000、5000、7000）下也有提升。

#### 关键预测图

- **CNN_1000 预测 vs 实际**
  ![CNN_1000](../res/cnn/spikelength/plots/spikelength_CNN_1000_prediction_vs_actual.png)
- **RandomForest_1000 预测 vs 实际**
  ![RF_1000](../res/base/spikelength/plots/spikelength_RandomForest_1000_prediction_vs_actual.png)
- **XGBoost_1000 预测 vs 实际**
  ![XGBoost_1000](../res/base/spikelength/plots/spikelength_XGBoost_1000_prediction_vs_actual.png)
- **LightGBM_1000 预测 vs 实际**
  ![LightGBM_1000](../res/base/spikelength/plots/spikelength_LightGBM_1000_prediction_vs_actual.png)
- **Lasso_1000 预测 vs 实际**
  ![Lasso_1000](../res/base/spikelength/plots/spikelength_Lasso_1000_prediction_vs_actual.png)

### 3.2 特征数量影响

- **CNN模型**：在特征数增加时性能持续提升，7000特征下R²最高。
- **传统模型**：如RandomForest，随特征数增加性能稳步提升，但提升幅度有限。

### 3.3 CNN网络结构机制解读

- **结构亮点**：  
  - 多层一维卷积（Conv1D）+池化（MaxPooling）+全连接（Dense）结构，能自动提取SNP序列中的局部模式和高阶特征。
  - 使用ReLU激活、BatchNorm和Dropout，有助于提升非线性表达能力和防止过拟合。
  - 参数量适中，适合中等规模样本。
- **机制分析**：  
  - 在1000个SNP时，网络能有效捕捉到关键遗传信号，表现优于传统模型。
  - 特征数过多时，网络参数量相对样本数变大，噪声增多，导致泛化能力下降。
  - 传统模型（如RF）对高维特征更鲁棒，但难以自动学习复杂的非线性特征交互。

### 3.4 适用性与优化建议

- **CNN适用场景**：特征已做初步筛选（如1000~3000 SNP），样本量充足时，CNN能充分发挥深度特征提取优势。
- **传统模型适用场景**：特征数较多、样本量有限时，RandomForest等集成方法更稳健。
- **优化建议**：
  - 可尝试在特征选择后，进一步微调CNN结构（如增加正则化、调整卷积核数、引入残差结构等）。
  - 结合特征重要性分析，筛选最具信息量的SNP输入CNN。

## 4. 结论与建议

1. **spikelength性状的基因组预测，CNN在高特征数时表现持续提升，传统模型在高维下也有稳定表现。**
2. **CNN网络结构能有效提取局部遗传模式，但对特征数量和样本量敏感，需防止过拟合。**
3. **推荐流程**：先用RF/Lasso等方法筛选特征，再用CNN做深度建模，有望获得最优结果。 