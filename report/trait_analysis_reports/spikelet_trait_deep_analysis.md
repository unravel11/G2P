# spikelet（小穗数）性状深度分析报告

## 1. 概述

本报告聚焦于小麦小穗数（spikelet）性状的基因组预测实验，系统对比自研CNN深度学习模型与多种传统机器学习模型（RandomForest、XGBoost、LightGBM、Lasso）在不同SNP特征数量下的表现，并结合CNN网络结构进行机制分析。

## 2. 性能指标总览

| 模型           | 特征数 | R² (决定系数) | RMSE   | Pearson相关系数 |
|----------------|--------|--------------|--------|----------------|
| **CNN**        | 100    | 0.1491       | 0.9985 | 0.4016         |
|                | 1000   | 0.2386       | 0.9445 | 0.4984         |
|                | 3000   | 0.2761       | 0.9210 | 0.5306         |
|                | 5000   | 0.2263       | 0.9521 | 0.5032         |
|                | 7000   | 0.2715       | 0.9239 | 0.5491         |
| **RandomForest**| 100   | 0.1635       | 0.9900 | 0.4121         |
|                | 1000   | 0.2227       | 0.9543 | 0.4737         |
|                | 3000   | 0.2461       | 0.9399 | 0.4985         |
|                | 5000   | 0.2568       | 0.9332 | 0.5129         |
|                | 7000   | 0.2595       | 0.9315 | 0.5149         |
| **XGBoost**    | 100    | 0.1472       | 0.9996 | 0.4505         |
|                | 1000   | 0.2617       | 0.9301 | 0.5254         |
|                | 3000   | 0.3187       | 0.8935 | 0.5686         |
|                | 5000   | 0.3226       | 0.8909 | 0.5701         |
|                | 7000   | 0.3464       | 0.8751 | 0.5915         |
| **LightGBM**   | 100    | 0.1610       | 0.9915 | 0.4441         |
|                | 1000   | 0.2538       | 0.9350 | 0.5213         |
|                | 3000   | 0.2809       | 0.9179 | 0.5418         |
|                | 5000   | 0.3172       | 0.8944 | 0.5640         |
|                | 7000   | 0.3062       | 0.9017 | 0.5565         |
| **Lasso**      | 100    | 0.2057       | 0.9647 | 0.4613         |
|                | 1000   | 0.3323       | 0.8845 | 0.5768         |
|                | 3000   | 0.3426       | 0.8776 | 0.5896         |
|                | 5000   | 0.3413       | 0.8785 | 0.5945         |
|                | 7000   | 0.3504       | 0.8724 | 0.5991         |

*注：所有数据均为最新实验结果。*

## 3. 深度分析

### 3.1 最佳模型表现

- **CNN_1000** 在1000个SNP时取得R²（0.2386）和Pearson相关系数（0.4984），在高特征数下性能持续提升。
- **RandomForest_7000** 在7000个SNP时R²达到0.2595，表现稳定。
- **XGBoost、LightGBM、Lasso** 在高特征数（3000、5000、7000）下也有提升。

#### 关键预测图

- **CNN_1000 预测 vs 实际**
  ![CNN_1000](../res/cnn/spikelet/plots/spikelet_CNN_1000_prediction_vs_actual.png)
- **RandomForest_1000 预测 vs 实际**
  ![RF_1000](../res/base/spikelet/plots/spikelet_RandomForest_1000_prediction_vs_actual.png)
- **XGBoost_1000 预测 vs 实际**
  ![XGBoost_1000](../res/base/spikelet/plots/spikelet_XGBoost_1000_prediction_vs_actual.png)
- **LightGBM_1000 预测 vs 实际**
  ![LightGBM_1000](../res/base/spikelet/plots/spikelet_LightGBM_1000_prediction_vs_actual.png)
- **Lasso_1000 预测 vs 实际**
  ![Lasso_1000](../res/base/spikelet/plots/spikelet_Lasso_1000_prediction_vs_actual.png)

### 3.2 特征数量影响

- **CNN模型**：在特征数增加时性能持续提升，7000特征下R²最高。
- **传统模型**：如RandomForest，随特征数增加性能稳步提升，但提升幅度有限。

### 3.3 CNN网络结构机制解读

- **结构亮点**：  
  - 多层一维卷积（Conv1D）+池化（MaxPooling）+全连接（Dense）结构，能自动提取SNP序列中的局部模式和高阶特征。
  - 使用ReLU激活、BatchNorm和Dropout，有助于提升非线性表达能力和防止过拟合。
  - 参数量适中，适合中等规模样本。
- **机制分析**：  
  - 在1000个SNP时，网络能有效捕捉到关键遗传信号，表现优于传统模型。
  - 特征数过多时，网络参数量相对样本数变大，噪声增多，导致泛化能力下降。
  - 传统模型（如RF）对高维特征更鲁棒，但难以自动学习复杂的非线性特征交互。

### 3.4 适用性与优化建议

- **CNN适用场景**：特征已做初步筛选（如1000~3000 SNP），样本量充足时，CNN能充分发挥深度特征提取优势。
- **传统模型适用场景**：特征数较多、样本量有限时，RandomForest等集成方法更稳健。
- **优化建议**：
  - 可尝试在特征选择后，进一步微调CNN结构（如增加正则化、调整卷积核数、引入残差结构等）。
  - 结合特征重要性分析，筛选最具信息量的SNP输入CNN。

## 4. 结论与建议

1. **spikelet性状的基因组预测，CNN在高特征数时表现持续提升，传统模型在高维下也有稳定表现。**
2. **CNN网络结构能有效提取局部遗传模式，但对特征数量和样本量敏感，需防止过拟合。**
3. **推荐流程**：先用RF/Lasso等方法筛选特征，再用CNN做深度建模，有望获得最优结果。 