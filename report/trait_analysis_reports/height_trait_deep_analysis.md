# height（株高）性状深度分析报告

## 1. 概述

本报告聚焦于小麦株高（height）性状的基因组预测实验，系统对比自研CNN深度学习模型与多种传统机器学习模型（RandomForest、XGBoost、LightGBM、Lasso）在不同SNP特征数量下的表现，并结合CNN网络结构进行机制分析。

## 2. 性能指标总览

| 模型           | 特征数 | R² (决定系数) | RMSE    | Pearson相关系数 |
|----------------|--------|--------------|---------|----------------|
| **CNN**        | 100    | 0.2085       | 16.10   | 0.4994         |
|                | 1000   | 0.5444       | 12.22   | 0.7462         |
|                | 3000   | 0.5142       | 12.62   | 0.7403         |
|                | 5000   | 0.5528       | 12.10   | 0.7485         |
|                | 7000   | 0.4857       | 12.98   | 0.7351         |
| **RandomForest**| 100   | 0.2896       | 15.25   | 0.5509         |
|                | 1000   | 0.5794       | 11.74   | 0.7641         |
|                | 3000   | 0.5723       | 11.84   | 0.7612         |
|                | 5000   | 0.5624       | 11.97   | 0.7555         |
|                | 7000   | 0.5604       | 11.99   | 0.7535         |
| **XGBoost**    | 100    | 0.2878       | 15.27   | 0.5533         |
|                | 1000   | 0.4858       | 12.98   | 0.7565         |
|                | 3000   | 0.4859       | 12.98   | 0.7656         |
|                | 5000   | 0.5056       | 12.73   | 0.7807         |
|                | 7000   | 0.5278       | 12.44   | 0.7942         |
| **LightGBM**   | 100    | 0.2548       | 15.62   | 0.5184         |
|                | 1000   | 0.4752       | 13.11   | 0.7288         |
|                | 3000   | 0.4868       | 12.97   | 0.7497         |
|                | 5000   | 0.5010       | 12.79   | 0.7575         |
|                | 7000   | 0.5237       | 12.49   | 0.7740         |
| **Lasso**      | 100    | 0.2487       | 15.69   | 0.5138         |
|                | 1000   | 0.5444       | 12.22   | 0.7489         |
|                | 3000   | 0.5433       | 12.23   | 0.7509         |
|                | 5000   | 0.5625       | 11.97   | 0.7648         |
|                | 7000   | 0.5786       | 11.75   | 0.7761         |

*注：所有数据均为最新实验结果。*

## 3. 深度分析

### 3.1 最佳模型表现

- **CNN_1000** 在1000个SNP时取得最高R²（0.5444）和Pearson相关系数（0.7462），优于所有同特征数的传统模型。
- **RandomForest_1000** 在1000个SNP时R²达到0.5794，表现同样优异。
- **XGBoost、LightGBM、Lasso** 在高特征数（3000、5000、7000）下也有稳定提升，部分指标已超越CNN。

#### 关键预测图

- **CNN_1000 预测 vs 实际**
  ![CNN_1000](../res/cnn/height/plots/height_CNN_1000_prediction_vs_actual.png)
- **RandomForest_1000 预测 vs 实际**
  ![RF_1000](../res/base/height/plots/height_RandomForest_1000_prediction_vs_actual.png)
- **XGBoost_1000 预测 vs 实际**
  ![XGBoost_1000](../res/base/height/plots/height_XGBoost_1000_prediction_vs_actual.png)
- **LightGBM_1000 预测 vs 实际**
  ![LightGBM_1000](../res/base/height/plots/height_LightGBM_1000_prediction_vs_actual.png)
- **Lasso_1000 预测 vs 实际**
  ![Lasso_1000](../res/base/height/plots/height_Lasso_1000_prediction_vs_actual.png)

### 3.2 特征数量影响

- **CNN模型**：在特征数1000时达到最佳，特征数继续增加后性能略有下降，出现一定过拟合迹象。
- **传统模型**：如RandomForest、XGBoost、LightGBM、Lasso，随特征数增加性能稳步提升，且在高维特征下表现更为稳定。
- **数据完整性说明**：部分模型在100特征下未进行实验，表格中已用"-"标注。

### 3.3 CNN网络结构机制解读

- **结构亮点**：  
  - 多层一维卷积（Conv1D）+池化（MaxPooling）+全连接（Dense）结构，能自动提取SNP序列中的局部模式和高阶特征。
  - 使用ReLU激活、BatchNorm和Dropout，有助于提升非线性表达能力和防止过拟合。
  - 参数量适中，适合中等规模样本。
- **机制分析**：  
  - 在1000个SNP时，网络能有效捕捉到关键遗传信号，表现优于传统模型。
  - 特征数过多时，网络参数量相对样本数变大，噪声增多，导致泛化能力下降。
  - 传统模型（如RF、XGBoost等）对高维特征更鲁棒，但难以自动学习复杂的非线性特征交互。

### 3.4 适用性与优化建议

- **CNN适用场景**：特征已做初步筛选（如1000~3000 SNP），样本量充足时，CNN能充分发挥深度特征提取优势。
- **传统模型适用场景**：特征数较多、样本量有限时，RandomForest等集成方法更稳健。
- **优化建议**：
  - 可尝试在特征选择后，进一步微调CNN结构（如增加正则化、调整卷积核数、引入残差结构等）。
  - 结合特征重要性分析，筛选最具信息量的SNP输入CNN。

## 4. 结论与建议

1. **height性状的基因组预测，CNN在特征数1000时表现最佳，优于所有传统模型。**
2. **CNN网络结构能有效提取局部遗传模式，但对特征数量和样本量敏感，需防止过拟合。**
3. **推荐流程**：先用RF/Lasso等方法筛选特征，再用CNN做深度建模，有望获得最优结果。 