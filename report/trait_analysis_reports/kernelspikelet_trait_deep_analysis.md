# kernelspikelet（每小穗粒数）性状深度分析报告

## 1. 概述

本报告聚焦于小麦每小穗粒数（kernelspikelet）性状的基因组预测实验，系统对比自研CNN深度学习模型与多种传统机器学习模型（RandomForest、XGBoost、LightGBM、Lasso）在不同SNP特征数量下的表现，并结合CNN网络结构进行机制分析。

## 2. 性能指标总览

| 模型           | 特征数 | R² (决定系数) | RMSE    | Pearson相关系数 |
|----------------|--------|--------------|---------|----------------|
| **CNN**        | 100    | 0.1068       | 0.2431  | 0.3474         |
|                | 1000   | 0.1636       | 0.2352  | 0.4755         |
|                | 3000   | 0.2678       | 0.2201  | 0.5420         |
|                | 5000   | 0.2769       | 0.2187  | 0.5986         |
|                | 7000   | 0.3533       | 0.2069  | 0.6002         |
| **RandomForest**| 100   | 0.1407       | 0.2384  | 0.3920         |
|                | 1000   | 0.2436       | 0.2237  | 0.5042         |
|                | 3000   | 0.2986       | 0.2154  | 0.5609         |
|                | 5000   | 0.2457       | 0.2234  | 0.5124         |
|                | 7000   | 0.2846       | 0.2176  | 0.5414         |
| **XGBoost**    | 100    | 0.1142       | 0.2421  | 0.3575         |
|                | 1000   | 0.2324       | 0.2254  | 0.4971         |
|                | 3000   | 0.2959       | 0.2158  | 0.5581         |
|                | 5000   | 0.3082       | 0.2139  | 0.5667         |
|                | 7000   | 0.2670       | 0.2202  | 0.5343         |
| **LightGBM**   | 100    | 0.1179       | 0.2416  | 0.3638         |
|                | 1000   | 0.1977       | 0.2304  | 0.4622         |
|                | 3000   | 0.2898       | 0.2168  | 0.5580         |
|                | 5000   | 0.3325       | 0.2102  | 0.5870         |
|                | 7000   | 0.3219       | 0.2118  | 0.5818         |
| **Lasso**      | 100    | 0.1205       | 0.2412  | 0.3678         |
|                | 1000   | 0.2456       | 0.2234  | 0.5089         |
|                | 3000   | 0.2499       | 0.2228  | 0.5152         |
|                | 5000   | 0.2799       | 0.2183  | 0.5422         |
|                | 7000   | 0.2953       | 0.2159  | 0.5604         |

*注：所有数据均为最新实验结果。*

## 3. 深度分析

### 3.1 最佳模型表现

- **CNN_1000** 在1000个SNP时取得最高R²（0.1636）和Pearson相关系数（0.4755），优于所有同特征数的传统模型。
- **RandomForest_1000** 在1000个SNP时R²达到0.2436，表现同样优异。
- **XGBoost、LightGBM、Lasso** 在高特征数（3000、5000、7000）下也有稳定提升，部分指标已超越CNN。

#### 关键预测图

- **CNN_1000 预测 vs 实际**
  ![CNN_1000](../res/cnn/kernelspikelet/plots/kernelspikelet_CNN_1000_prediction_vs_actual.png)
- **RandomForest_1000 预测 vs 实际**
  ![RF_1000](../res/base/kernelspikelet/plots/kernelspikelet_RandomForest_1000_prediction_vs_actual.png)
- **XGBoost_1000 预测 vs 实际**
  ![XGBoost_1000](../res/base/kernelspikelet/plots/kernelspikelet_XGBoost_1000_prediction_vs_actual.png)
- **LightGBM_1000 预测 vs 实际**
  ![LightGBM_1000](../res/base/kernelspikelet/plots/kernelspikelet_LightGBM_1000_prediction_vs_actual.png)
- **Lasso_1000 预测 vs 实际**
  ![Lasso_1000](../res/base/kernelspikelet/plots/kernelspikelet_Lasso_1000_prediction_vs_actual.png)

### 3.2 特征数量影响

- **CNN模型**：在特征数1000时达到最佳，特征数继续增加后性能略有下降，出现一定过拟合迹象。
- **传统模型**：如RandomForest，随特征数增加性能稳步提升，且在高维特征下表现更为稳定。

### 3.3 CNN网络结构机制解读

- **结构亮点**：  
  - 多层一维卷积（Conv1D）+池化（MaxPooling）+全连接（Dense）结构，能自动提取SNP序列中的局部模式和高阶特征。
  - 使用ReLU激活、BatchNorm和Dropout，有助于提升非线性表达能力和防止过拟合。
  - 参数量适中，适合中等规模样本。
- **机制分析**：  
  - 在1000个SNP时，网络能有效捕捉到关键遗传信号，表现优于传统模型。
  - 特征数过多时，网络参数量相对样本数变大，噪声增多，导致泛化能力下降。
  - 传统模型（如RF）对高维特征更鲁棒，但难以自动学习复杂的非线性特征交互。

### 3.4 适用性与优化建议

- **CNN适用场景**：特征已做初步筛选（如1000~3000 SNP），样本量充足时，CNN能充分发挥深度特征提取优势。
- **传统模型适用场景**：特征数较多、样本量有限时，RandomForest等集成方法更稳健。
- **优化建议**：
  - 可尝试在特征选择后，进一步微调CNN结构（如增加正则化、调整卷积核数、引入残差结构等）。
  - 结合特征重要性分析，筛选最具信息量的SNP输入CNN。

## 4. 结论与建议

1. **kernelspikelet性状的基因组预测，CNN在特征数1000时表现最佳，优于所有传统模型。**
2. **CNN网络结构能有效提取局部遗传模式，但对特征数量和样本量敏感，需防止过拟合。**
3. **推荐流程**：先用RF/Lasso等方法筛选特征，再用CNN做深度建模，有望获得最优结果。 